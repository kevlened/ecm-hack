import React, { useState } from "react";
import { Card, CardContent } from "@/components/ui/card";
import { motion } from "framer-motion";

type SNP = {
  id: string;
  protein: string;
  system: string;
  organ: string;
  location: string;
  type: "natural" | "mutation";
};

type OrganStats = {
  system: string;
  organ: string;
  proteinCount: number;
  snpCount: number;
  naturalCount: number;
  mutationCount: number;
};

const snps: SNP[] = [
  { id: "snp1", protein: "Collagen I", system: "Circulatory", organ: "Heart", location: "Chromosome 7", type: "mutation" },
  { id: "snp2", protein: "Elastin", system: "Circulatory", organ: "Heart", location: "Chromosome 2", type: "natural" },
  { id: "snp3", protein: "Fibronectin", system: "Circulatory", organ: "Heart", location: "Chromosome 5", type: "mutation" },
  // ...add more SNPs
];

function getOrganStats(organ: string): OrganStats {
  const organSnps = snps.filter((s) => s.organ === organ);
  return {
    system: organSnps[0]?.system ?? "Unknown",
    organ,
    proteinCount: new Set(organSnps.map((s) => s.protein)).size,
    snpCount: organSnps.length,
    naturalCount: organSnps.filter((s) => s.type === "natural").length,
    mutationCount: organSnps.filter((s) => s.type === "mutation").length,
  };
}

export default function BodyMap() {
  const [selectedSnp, setSelectedSnp] = useState<SNP | null>(null);
  const [selectedOrgan, setSelectedOrgan] = useState<string | null>(null);

  const handleSnpClick = (snp: SNP) => {
    setSelectedSnp(snp);
    setSelectedOrgan(snp.organ);
  };

  const handleOrganClick = (organ: string) => {
    setSelectedOrgan(organ);
    setSelectedSnp(null); // clear SNP selection
  };

  const organStats = selectedOrgan ? getOrganStats(selectedOrgan) : null;

  return (
    <div className="flex gap-6">
      {/* Left: Human body with clickable SNPs */}
      <div className="relative w-1/2">
        <svg
          viewBox="0 0 200 400"
          className="w-full h-full border rounded-2xl shadow-md"
        >
          {/* Heart Area (click for stats) */}
          <motion.circle
            cx="100"
            cy="150"
            r="30"
            fill="#ff4d6d"
            className="cursor-pointer"
            whileHover={{ scale: 1.1 }}
            onClick={() => handleOrganClick("Heart")}
          />

          {/* Example SNP markers inside heart */}
          {snps
            .filter((s) => s.organ === "Heart")
            .map((snp, idx) => (
              <motion.circle
                key={snp.id}
                cx={100 + idx * 12 - 12}
                cy={150 + (idx % 2 === 0 ? -10 : 10)}
                r="6"
                fill={snp.type === "mutation" ? "#000" : "#fff"}
                stroke="#333"
                className="cursor-pointer"
                whileHover={{ scale: 1.3 }}
                onClick={() => handleSnpClick(snp)}
              />
            ))}
        </svg>
      </div>

      {/* Right: Info panel */}
      <Card className="w-1/2">
        <CardContent className="space-y-4">
          <h2 className="text-xl font-bold">Details</h2>

          {selectedSnp ? (
            <div>
              <h3 className="font-semibold">Selected SNP</h3>
              <p><strong>Protein:</strong> {selectedSnp.protein}</p>
              <p><strong>System:</strong> {selectedSnp.system}</p>
              <p><strong>Organ:</strong> {selectedSnp.organ}</p>
              <p><strong>Location:</strong> {selectedSnp.location}</p>
              <p><strong>Type:</strong> {selectedSnp.type}</p>
            </div>
          ) : (
            <p className="text-gray-500">Click a SNP or organ to see details</p>
          )}

          {organStats && (
            <div>
              <h3 className="font-semibold mt-4">Organ Stats</h3>
              <p><strong>System:</strong> {organStats.system}</p>
              <p><strong>Organ:</strong> {organStats.organ}</p>
              <p><strong>ECM Proteins Count:</strong> {organStats.proteinCount}</p>
              <p><strong>Total SNPs:</strong> {organStats.snpCount}</p>
              <p><strong>Natural SNPs:</strong> {organStats.naturalCount}</p>
              <p><strong>Mutations:</strong> {organStats.mutationCount}</p>
            </div>
          )}
        </CardContent>
      </Card>
    </div>
  );
}
