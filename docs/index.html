<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Human Body SNP Treemap</title>
    <style>
        body {
            font-family: sans-serif;
            text-align: center;
        }
        #chart {
            width: 928px;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <h1>Human Body SNP Treemap</h1>
    <div id="chart"></div>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script>
        const human_body_data = {
            "name": "Human Body",
            "children": [
                {
                    "name": "Nervous System",
                    "children": [
                        {
                            "name": "Brain",
                            "value": 100,
                            "natural_snps": 1000,
                            "mutated_snps": 50
                        },
                        {
                            "name": "Spinal Cord",
                            "value": 20,
                            "natural_snps": 200,
                            "mutated_snps": 5
                        }
                    ]
                },
                {
                    "name": "Cardiovascular System",
                    "children": [
                        {
                            "name": "Heart",
                            "value": 50,
                            "natural_snps": 500,
                            "mutated_snps": 25
                        },
                        {
                            "name": "Blood Vessels",
                            "value": 30,
                            "natural_snps": 300,
                            "mutated_snps": 100
                        }
                    ]
                },
                {
                    "name": "Respiratory System",
                    "children": [
                        {
                            "name": "Lungs",
                            "value": 60,
                            "natural_snps": 600,
                            "mutated_snps": 120
                        }
                    ]
                },
                {
                    "name": "Digestive System",
                    "children": [
                        {
                            "name": "Stomach",
                            "value": 40,
                            "natural_snps": 400,
                            "mutated_snps": 10
                        },
                        {
                            "name": "Liver",
                            "value": 45,
                            "natural_snps": 450,
                            "mutated_snps": 80
                        },
                        {
                            "name": "Intestines",
                            "value": 55,
                            "natural_snps": 550,
                            "mutated_snps": 200
                        }
                    ]
                }
            ]
        };

        // Specify the chartâ€™s dimensions.
        const width = 1154;
        const height = 1154;

        // Specify the color scale.
        const color = d3.scaleSequential(d3.interpolateRdYlGn).domain([1, 0]);

        // Compute the layout.
        const root = d3.treemap()
            .size([width, height])
            .padding(1)
            .round(true)
            (d3.hierarchy(human_body_data)
                .sum(d => d.value)
                .sort((a, b) => b.value - a.value));

        // Create the SVG container.
        const svg = d3.select("#chart").append("svg")
            .attr("viewBox", [0, 0, width, height])
            .attr("width", width)
            .attr("height", height)
            .attr("style", "max-width: 100%; height: auto; font: 10px sans-serif;");

        // Add a cell for each leaf of the hierarchy.
        const leaf = svg.selectAll("g")
            .data(root.leaves())
            .join("g")
            .attr("transform", d => `translate(${d.x0},${d.y0})`);

        // Append a tooltip.
        const format = d3.format(",d");
        leaf.append("title")
            .text(d => `${d.ancestors().reverse().map(d => d.data.name).join("/")}\nNatural SNPs: ${format(d.data.natural_snps)}\nMutated SNPs: ${format(d.data.mutated_snps)}`);

        // Append a color rectangle.
        leaf.append("rect")
            .attr("id", d => `leaf-${Math.random()}`)
            .attr("fill", d => {
                const ratio = d.data.mutated_snps / (d.data.natural_snps + d.data.mutated_snps);
                return color(ratio);
            })
            .attr("fill-opacity", 0.8)
            .attr("width", d => d.x1 - d.x0)
            .attr("height", d => d.y1 - d.y0);

        // Append a clipPath to ensure text does not overflow.
        leaf.append("clipPath")
            .attr("id", d => `clip-${Math.random()}`)
            .append("use")
            .attr("xlink:href", d => `#${d.leafUid}`);

        // Append multiline text.
        leaf.append("text")
            .selectAll("tspan")
            .data(d => d.data.name.split(/(?=[A-Z][a-z])|\s+/g).concat(`Mutations: ${format(d.data.mutated_snps)}`))
            .join("tspan")
            .attr("x", 3)
            .attr("y", (d, i, nodes) => `${(i === nodes.length - 1) * 0.3 + 1.1 + i * 0.9}em`)
            .attr("fill-opacity", (d, i, nodes) => i === nodes.length - 1 ? 0.7 : null)
            .text(d => d);
        function position(group, root) {
    group.selectAll("g")
        .attr("transform", d => d === root ? `translate(0,-30)` : `translate(${x(d.x0)},${y(d.y0)})`)
      .select("rect")
        .attr("width", d => d === root ? width : x(d.x1) - x(d.x0))
        .attr("height", d => d === root ? 30 : y(d.y1) - y(d.y0));
  }

  // When zooming in, draw the new nodes on top, and fade them in.
  function zoomin(d) {
    const group0 = group.attr("pointer-events", "none");
    const group1 = group = svg.append("g").call(render, d);

    x.domain([d.x0, d.x1]);
    y.domain([d.y0, d.y1]);

    svg.transition()
        .duration(750)
        .call(t => group0.transition(t).remove()
          .call(position, d.parent))
        .call(t => group1.transition(t)
          .attrTween("opacity", () => d3.interpolate(0, 1))
          .call(position, d));
  }

  // When zooming out, draw the old nodes on top, and fade them out.
  function zoomout(d) {
    const group0 = group.attr("pointer-events", "none");
    const group1 = group = svg.insert("g", "*").call(render, d.parent);

    x.domain([d.parent.x0, d.parent.x1]);
    y.domain([d.parent.y0, d.parent.y1]);

    svg.transition()
        .duration(750)
        .call(t => group0.transition(t).remove()
          .attrTween("opacity", () => d3.interpolate(1, 0))
          .call(position, d))
        .call(t => group1.transition(t)
          .call(position, d.parent));
  }
    </script>
</body>
</html>
